<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Safety Observations App</title>
  <style>
    body { font-family: 'Arial', sans-serif'; margin:0; padding:0; background-color:#e9e9e9; height:100vh; overflow:hidden; }
    .app-container { display:flex; flex-direction:column; height:100%; max-width:500px; margin:0 auto; background-color:white; box-shadow:0 0 15px rgba(0,0,0,0.2);}
    .header { text-align:center; padding:15px; font-size:18px; font-weight:bold; background-color:#333; color:white; border-bottom:1px solid #FF8C00; }
    .content-area { flex-grow:1; overflow-y:auto; margin-bottom:60px; }
    .tab-content { padding:10px 12px; display:none; height:100%; }
    .tab-content.active { display:block; }
    iframe { width:100%; height:100%; border:none; min-width:100%; background-color:transparent; }
    /* News card */
    #NewsTab { padding:10px; background-color:#f4f4f4; }
    .announcement-card { background-color:white; border-radius:8px; margin-bottom:12px; padding:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1); border-right:5px solid #FF8C00; display:flex; flex-direction:column; }
    .card-title { font-weight:bold; color:#333; font-size:16px; margin-bottom:5px; }
    .card-date { font-size:10px; color:#888; margin-bottom:10px; border-bottom:1px dashed #eee; padding-bottom:5px; }
    .card-content { font-size:13px; color:#555; }
    /* Info tab */
    .info-month { font-size:18px; font-weight:bold; margin:8px 0 14px 0; }
    .accordion { background-color:#f0f0f0; color:#222; cursor:pointer; padding:12px; width:100%; text-align:left; border:none; outline:none; transition:0.25s; font-size:15px; border-radius:6px; font-weight:700;}
    .accordion:hover, .accordion.activeAcc { background-color:#e0e0e0; }
    .panel { padding:12px 14px; display:none; background-color:white; overflow:auto; border-left:4px solid #FF8C00; margin-top:8px; border-radius:6px; }
    .panel ol { padding-left:20px; margin:0; line-height:1.6; font-size:14px; color:#333; }
    .panel li { margin-bottom:6px; }
    /* Nav Bar */
    .nav-bar { display:flex; justify-content:space-around; position:fixed; bottom:0; width:100%; max-width:500px; height:60px; background-color:white; box-shadow:0 -5px 15px rgba(0,0,0,0.15); z-index:10; left:50%; transform:translateX(-50%); }
    .nav-button { display:flex; flex-direction:column; align-items:center; justify-content:center; color:#777; font-size:11px; cursor:pointer; width:20%; transition:color 0.3s; }
    .nav-button.active { color:#FF8C00; font-weight:bold; }
    .nav-button:hover { color:#FF8C00; }
    .nav-icon { font-size:20px; margin-bottom:3px; }
    .icon-news::before { content:"üì∞"; }
    .icon-form::before { content:"üìù"; }
    .icon-data::before { content:"üìä"; }
    .icon-tasks::before { content:"‚úÖ"; }
    .icon-info::before { content:"‚ÑπÔ∏è"; }
    @media(min-width:600px){ .app-container{ max-width:1000px; box-shadow:0 0 25px rgba(0,0,0,0.3); height:90vh; margin-top:5vh; margin-bottom:5vh; border-radius:12px; overflow:hidden; } .nav-bar{max-width:1000px;} .nav-button span{font-size:14px;} .nav-icon{font-size:24px;} .announcement-card{max-width:800px; margin-left:auto; margin-right:auto;} }
  </style>
</head>
<body>
<div class="app-container">
  <div class="header">Safety Observations üë∑ My Observations App</div>

  <div class="content-area">
    <!-- News -->
    <div id="NewsTab" class="tab-content" data-src="https://docs.google.com/spreadsheets/d/1_SwxL5f4mWF5kd2yofCMCEE_WQp_2eroHDhXXPXtw1U/export?format=csv&gid=0">
      <div id="AnnouncementsContainer">
        <div class="announcement-card">
          <div class="card-date">Date: Loading...</div>
          <div class="card-title">Loading news...</div>
          <div class="card-content">If this persists, check Google Sheet sharing settings.</div>
        </div>
      </div>
    </div>

    <!-- Form -->
    <div id="FormTab" class="tab-content">
      <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSfYED_4UfHcmWn0fQOjtR5s8A0-Bhr4dwpe-80GjKkLeTR_Lw/viewform?embedded=true"></iframe>
    </div>

    <!-- Data -->
    <div id="DataTab" class="tab-content" data-src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTXlN-sE-IkQJLMaVOvRGSBYNLsDvwZTD15w7rarTIXBGoacF0C5_eiI7OmFs__zA8jtlwhy0ULLZ8N/pubhtml"></div>

    <!-- Tasks -->
    <div id="TasksTab" class="tab-content" data-src="PLACEHOLDER_DAILY_TASKS_URL"></div>

    <!-- Info Tab (New) -->
    <div id="InfoTab" class="tab-content">
      <div class="info-month" id="monthColorText">The Color Code of This Month is: <span id="colorName">...</span></div>

      <!-- Safety Responsibility -->
      <button class="accordion" id="safetyAccordion" role="button" aria-expanded="false" aria-controls="safetyPanel" tabindex="0">Safety Responsibility</button>
      <div class="panel" id="safetyPanel">
        <ol>
          <li>Reporting chain to follow site HSE / Safety supervisor, Coordinator & Manager.</li>
          <li>Visibly demonstrate the priority of safety in all activities.</li>
          <li>Understand & familiar with safety & health requirements (CSM, HIP, JSA, local laws, best practices).</li>
          <li>Conduct all TBTs and hand over records to HSE supervisor.</li>
          <li>Frequent HSE inspections & continuous monitoring.</li>
          <li>Report all NM, FAI, CA & PA to HSE supervisor.</li>
          <li>Report incidents causing injury or damage.</li>
          <li>Report misuse of equipment, tools, facilities.</li>
          <li>Report severe arguments, bullying, or fighting.</li>
          <li>Report any other HSE concerns immediately.</li>
        </ol>
      </div>

      <!-- Daily Safety Tip -->
      <button class="accordion" id="dailyTipsAccordion" role="button" aria-expanded="false" aria-controls="dailyTipsPanel" tabindex="0">Daily Safety Tip</button>
      <div class="panel" id="dailyTipsPanel">
        <p id="todayTip" style="font-size:15px; line-height:1.6;">Loading today's tip...</p>
      </div>

      <!-- Useful Links -->
      <button class="accordion" id="linksAccordion" role="button" aria-expanded="false" aria-controls="linksPanel" tabindex="0">Useful Links</button>
      <div class="panel" id="linksPanel">
        <ul>
          <li><a href="https://drive.google.com/file/d/15gvUFs5ELvaUhDVTapkvGf6a5GkGEx5s/view?usp=sharing" target="_blank">CSM Book (Important Safety Manual)</a></li>
          <li><a href="#" target="_blank">Daily Checklist</a></li>
          <li><a href="#" target="_blank">Observation Form CSV</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Nav Bar -->
  <div class="nav-bar">
    <div class="nav-button" onclick="openTab(event,'NewsTab')"><span class="nav-icon icon-news"></span><span>News</span></div>
    <div class="nav-button" onclick="openTab(event,'FormTab')"><span class="nav-icon icon-form"></span><span>Observation</span></div>
    <div class="nav-button" onclick="openTab(event,'DataTab')"><span class="nav-icon icon-data"></span><span>Safety Data</span></div>
    <div class="nav-button" onclick="openTab(event,'TasksTab')"><span class="nav-icon icon-tasks"></span><span>Daily Tasks</span></div>
    <div class="nav-button" onclick="openTab(event,'InfoTab')"><span class="nav-icon icon-info"></span><span>Info</span></div>
  </div>
</div>

<script>
  // ----- Load News CSV -----
  function loadNews(){
    const newsTab=document.getElementById('NewsTab');
    const container=document.getElementById('AnnouncementsContainer');
    const url=newsTab.getAttribute('data-src');
    if(!url || !url.includes('google.com/spreadsheets/d/')){ container.innerHTML='<div class="announcement-card"><div class="card-title" style="color:red;">Config Error</div><div class="card-content">Check Google Sheet CSV link.</div></div>'; return;}
    fetch(url).then(r=>{if(!r.ok)throw new Error(); return r.text();}).then(data=>{
      const rows=data.trim().split('\n').slice(1);
      let htmlContent='';
      rows.forEach(row=>{
        const cols=row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)||[];
        if(cols.length>=3){
          const date=cols[0].trim().replace(/^"|"$/g,''), title=cols[1].trim().replace(/^"|"$/g,''), content=cols[2].trim().replace(/^"|"$/g,'');
          htmlContent+=`<div class="announcement-card"><div class="card-date">Date: ${date}</div><div class="card-title">${title}</div><div class="card-content">${content}</div></div>`;
        }
      });
      container.innerHTML=htmlContent||'<div class="announcement-card"><div class="card-title">No News</div><div class="card-content">New news will appear here.</div></div>';
    }).catch(e=>{container.innerHTML='<div class="announcement-card"><div class="card-title" style="color:red;">Load Error</div><div class="card-content">Cannot fetch CSV data.</div></div>';});
  }

  // ----- Tab Control -----
  function openTab(evt,tabName){
    const tabs=document.getElementsByClassName('tab-content');
    const btns=document.getElementsByClassName('nav-button');
    for(let t of tabs) t.classList.remove('active');
    for(let b of btns) b.classList.remove('active');
    const current=document.getElementById(tabName);
    if(!current) return;
    current.classList.add('active');
    evt.currentTarget.classList.add('active');
    const url=current.getAttribute('data-src');
    if(tabName==='NewsTab'){ loadNews(); }
    else if(url && current.children.length===0){ const iframe=document.createElement('iframe'); iframe.src=url; current.appendChild(iframe); }
  }

  // ----- Accordion -----
  function toggleAccordion(button){
    button.classList.toggle('activeAcc');
    const panel=document.getElementById(button.getAttribute('aria-controls'));
    if(panel.style.maxHeight){ panel.style.maxHeight=null; button.setAttribute('aria-expanded','false'); }
    else{ panel.style.maxHeight=panel.scrollHeight+'px'; button.setAttribute('aria-expanded','true'); }
  }
  ['safetyAccordion','dailyTipsAccordion','linksAccordion'].forEach(id=>{
    const btn=document.getElementById(id);
    btn.addEventListener('click',()=>toggleAccordion(btn));
    btn.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){ e.preventDefault(); toggleAccordion(btn); }});
  });

  // ----- Month Color -----
  (function(){ const cycle=['Red','Blue','Yellow','Green']; const startIndex=9; const m=new Date().getMonth(); const offset=((m-startIndex)%4+4)%4; const color=cycle[offset]; const el=document.getElementById('colorName'); if(el){el.textContent=color; el.style.color=color.toLowerCase(); el.style.fontWeight='700';}})();

  // ----- Daily Safety Tips -----
  const dailyTips=[
    "ü¶∫ Always wear proper PPE before entering the site.",
    "üîß Inspect your tools and equipment before use.",
    "üßπ Keep walkways and work areas clear of debris.",
    "‚ö†Ô∏è Report unsafe conditions immediately to your supervisor.",
    "üèãÔ∏è‚Äç‚ôÇÔ∏è Do not lift heavy objects alone; use proper lifting techniques or equipment.",
    "üìù Attend daily safety briefings (TBT) and follow instructions carefully.",
    "üßº Keep your workspace clean and organized throughout the day.",
    "‚ö° Immediately report any damaged electrical or mechanical equipment.",
    "ü™ú Ensure scaffolds, ladders, and platforms are secure before use.",
    "‚úã Stop work if a hazard presents a serious risk.",
    "üßó‚Äç‚ôÇÔ∏è Always use fall protection when working at heights.",
    "üß§ Wear gloves when handling sharp or rough materials.",
    "üî• Check fire extinguishers and emergency exits regularly.",
    "üèóÔ∏è Use caution when operating machinery and follow standard procedures.",
    "üö´ Avoid horseplay or unsafe behavior on the site.",
    "üöú Keep clear of moving equipment and vehicles.",
    "üîí Follow lockout/tagout procedures when working on machinery.",
    "üìù Report near-misses and incidents to improve site safety.",
    "üíß Maintain hydration and take breaks in extreme weather.",
    "üëÄ Be aware of your surroundings and communicate hazards.",
    "üèãÔ∏è‚Äç‚ôÄÔ∏è Use proper lifting techniques to prevent back injuries.",
    "ü©π Ensure first aid kits are accessible and stocked.",
    "üß™ Store chemicals and flammable materials safely.",
    "‚ö° Avoid shortcuts that compromise safety procedures.",
    "ü¶∫ Make sure PPE fits correctly and is worn at all times.",
    "ü™ù Double-check rigging and lifting equipment before use.",
    "üìû Keep emergency contact numbers readily available.",
    "üö¶ Follow traffic rules in site roads and pedestrian zones.",
    "üè´ Participate in drills and safety training sessions.",
    "ü§ù Encourage coworkers to follow safe practices and lead by example."
  ];
  function showTodayTip(){ const todayIndex=(new Date().getDate()-1)%dailyTips.length; const el=document.getElementById('todayTip'); if(el) el.textContent=dailyTips[todayIndex];}
  showTodayTip();

  // ----- Default Tab -----
  window.onload=function(){ document.querySelector('.nav-button').click(); };
</script>
</body>
</html>